{% extends 'base.html' %}

{% block title %}Model v{{ model.version }} - ML-Ops{% endblock %}

{% block content %}
<div class="flex flex-between flex-center mb-3">
    <h1>Model v{{ model.version }}</h1>
    <div class="flex gap-2">
        <a href="{% url 'model_registry:index' %}" class="btn btn-secondary">Back to Registry</a>
        <form method="post" action="{% url 'model_registry:delete_model' model.version %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger" onclick="return confirm('Delete this model?')">Delete</button>
        </form>
    </div>
</div>

<div class="grid grid-2">
    <div class="card">
        <div class="card-header">
            <h3>Model Details</h3>
        </div>
        <table>
            <tr>
                <th>Version</th>
                <td>{{ model.version }}</td>
            </tr>
            <tr>
                <th>Model Type</th>
                <td>{{ model.model_type }}</td>
            </tr>
            <tr>
                <th>Training Mode</th>
                <td>
                    <span class="badge {% if model.training_mode == 'new' %}badge-accent{% else %}badge-success{% endif %}">
                        {{ model.get_training_mode_display }}
                    </span>
                </td>
            </tr>
            <tr>
                <th>Parent Model</th>
                <td>
                    {% if model.parent %}
                    <a href="{% url 'model_registry:model_detail' model.parent.version %}">v{{ model.parent.version }}</a>
                    {% else %}
                    -
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Created At</th>
                <td>{{ model.created_at }}</td>
            </tr>
            <tr>
                <th>File Hash</th>
                <td class="text-small">{{ model.file_hash|default:"-" }}</td>
            </tr>
        </table>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3>Metrics</h3>
        </div>
        {% if model.metrics %}
        <table>
            {% for key, value in model.metrics.items %}
            <tr>
                <th>{{ key }}</th>
                <td>{{ value|floatformat:4 }}</td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p class="text-muted">No metrics available.</p>
        {% endif %}
    </div>
</div>

<div class="grid grid-2 mt-3">
    <div class="card">
        <div class="card-header">
            <h3>Metadata</h3>
        </div>
        <div class="json-display">
            {{ model.metadata }}
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3>Lineage</h3>
        </div>
        
        <h4 class="mb-2">Ancestors</h4>
        {% if lineage|length > 1 %}
        <ul style="list-style: none;">
            {% for ancestor in lineage %}
            <li class="mb-1">
                {% if forloop.counter > 1 %}â†³{% endif %}
                <a href="{% url 'model_registry:model_detail' ancestor.version %}">
                    v{{ ancestor.version }}
                </a>
                ({{ ancestor.model_type }})
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">No ancestors (root model)</p>
        {% endif %}
        
        <h4 class="mt-2 mb-2">Children (Fine-tuned from this model)</h4>
        {% if children %}
        <ul style="list-style: none;">
            {% for child in children %}
            <li class="mb-1">
                <a href="{% url 'model_registry:model_detail' child.version %}">
                    v{{ child.version }}
                </a>
                ({{ child.model_type }})
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">No child models</p>
        {% endif %}
    </div>
</div>
{% endblock %}
